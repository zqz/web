<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{if .PageTitle}}{{t "site.title"}} - {{t .PageTitle}}{{else}}{{t "site.title"}}{{end}}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" integrity="sha384-JEQK7wHuRGUYVrNb5ZeM/rAaGQ1wtADRgunBBdOX5sAxflQSSAqtsocsJUyWjbRI" crossorigin="anonymous">
    <script src="/static/htmx.min.js"></script>
    <style>
        :root {
            --bg: #0d0d0d;
            --text: #e6e6e6;
            --muted: #737373;
            --border: #262626;
            --accent: #a3a3a3;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'IBM Plex Mono', ui-monospace, monospace;
            font-size: 13px;
            line-height: 1.6;
            color: var(--text);
            background: var(--bg);
            margin: 0;
            min-height: 100vh;
        }
        .wrap { max-width: 52rem; margin: 0 auto; padding: 2rem 1.25rem; }
        header { margin-bottom: 2rem; }
        .site-title { font-size: 1rem; font-weight: 500; margin: 0 0 0.75rem 0; letter-spacing: 0.02em; }
        nav { font-size: 12px; color: var(--muted); display: flex; align-items: center; gap: 1rem; }
        nav a, nav button { color: var(--text); text-decoration: none; background: none; border: none; padding: 0; font: inherit; cursor: pointer; }
        nav a:hover, nav button:hover { color: var(--accent); }
        .nav-user { display: inline-flex; align-items: center; margin-left: auto; }
        .nav-user a { color: inherit; text-decoration: none; }
        .nav-user a:hover { opacity: 0.9; }
        .nav-user svg { width: 1rem; height: 1rem; color: var(--muted); }
        .nav-user-tag { display: inline-flex; align-items: center; justify-content: center; min-width: 32px; height: 1.5rem; font-size: 10px; font-weight: 500; border-radius: 2px; color: #0d0d0d; background: var(--border); }
        h2 { font-size: 12px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.08em; color: var(--muted); margin: 0 0 1rem 0; }
        .page-title-row { display: flex; align-items: center; justify-content: space-between; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .page-title-row h2 { margin: 0; }
        .page-title-row .title-extra { flex-shrink: 0; }
        .page-title-row .title-extra input[type="search"] { min-width: 12rem; }
        h3 { font-size: 11px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.06em; color: var(--muted); margin: 1.25rem 0 0.5rem 0; }
        .list { list-style: none; padding: 0; margin: 0; }
        .list li { padding: 0.4rem 0; border-bottom: 1px solid var(--border); display: flex; flex-wrap: wrap; align-items: baseline; gap: 0.5rem 1rem; }
        .list-badge { flex-shrink: 0; width: 3.5rem; }
        .list li:last-child { border-bottom: none; }
        .file-name { font-weight: 500; min-width: 0; }
        .file-name a, .main a { color: var(--text); text-decoration: none; }
        .file-name a:hover, .main a:hover { text-decoration: underline; }
        .file-comment-icon { display: inline-flex; align-items: center; margin-left: 0.25rem; color: var(--muted); cursor: help; vertical-align: middle; background: none; border: none; padding: 0; font: inherit; }
        .file-comment-icon:hover { color: var(--text); }
        .file-comment-tooltip { position: fixed; z-index: 1000; max-width: 20rem; padding: 0.5rem 0.75rem; font-size: 11px; line-height: 1.4; color: var(--text); background: #1a1a1a; border: 1px solid var(--border); border-radius: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); white-space: pre-wrap; word-break: break-word; pointer-events: none; display: none; }
        .file-comment-tooltip.is-visible { display: block; }
        .file-meta { font-size: 11px; color: var(--muted); }
        .file-actions { font-size: 11px; margin-left: auto; }
        .file-actions a, .file-actions button { color: var(--muted); text-decoration: none; background: none; border: none; padding: 0; font: inherit; cursor: pointer; }
        .file-actions a:hover, .file-actions button:hover { color: var(--text); }
        .file-actions a + a, .file-actions a + button, .file-actions button + a, .file-actions button + button { margin-left: 0.6rem; }
        .file-actions .file-copy-link { margin-left: 0.6rem; padding: 0; border: none; background: none; cursor: pointer; color: var(--muted); font: inherit; line-height: 1; vertical-align: middle; }
        .file-actions .file-copy-link:hover { color: var(--text); }
        .file-actions .file-copy-link.copied { color: #4ade80; }
        .file-actions a.danger:hover, .file-actions button.danger:hover { color: #f87171; }
        .badge { font-size: 10px; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge--public { color: #4ade80; }
        .badge--private { color: #f87171; }
        .uploader-tag { display: inline-block; padding: 0 0.25rem; font-size: 10px; font-weight: 500; border-radius: 2px; min-width: 32px; text-align: center; margin-right: 0.35rem; }
        .load-more { margin-top: 1rem; }
        .load-more button { font: inherit; font-size: 11px; color: var(--muted); background: none; border: 1px solid var(--border); padding: 0.35rem 0.75rem; cursor: pointer; }
        .load-more button:hover { color: var(--text); border-color: var(--muted); }
        .htmx-request .load-more button { opacity: 0.6; }
        #files-content { min-height: 2rem; }
        input, textarea, button { font: inherit; color: var(--text); background: var(--bg); border: 1px solid var(--border); padding: 0.35rem 0.5rem; }
        input:focus, textarea:focus { outline: none; border-color: var(--muted); }
        textarea { resize: vertical; min-height: 4rem; }
        button { cursor: pointer; }
        button:hover { border-color: var(--muted); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-danger { color: #f87171; border-color: #7f1d1d; }
        .btn-danger:hover { border-color: #f87171; }
        .upload-zone { display: block; border: 2px dashed var(--border); padding: 1.5rem; cursor: pointer; margin-bottom: 1rem; }
        .upload-zone:hover { border-color: var(--muted); }
        pre, code { font-size: 11px; background: #1a1a1a; padding: 0.25rem 0.4rem; border-radius: 2px; }
        pre { padding: 0.75rem; overflow-x: auto; margin: 0.5rem 0; }
        label { display: block; margin-bottom: 0.25rem; color: var(--muted); font-size: 11px; }
        .form-group { margin-bottom: 1rem; }
        .status { margin-top: 0.75rem; padding: 0.5rem; font-size: 11px; }
    </style>
</head>
<body data-copied="{{t "common.copied"}}">
    <script>globalThis.I18N = {{ i18nJSON }};</script>
    {{if and .User .User.Banned}}
    <div class="wrap">
        <p>{{t "site.banned"}}</p>
    </div>
    {{else}}
    <div class="wrap">
        <header>
            <h1 class="site-title">{{t "site.title"}}</h1>
            <nav>
                <a href="/">{{t "nav.upload"}}</a>
                <a href="/files">{{t "nav.files"}}</a>
                {{if .ShowUsers}}<a href="/users">{{t "nav.users"}}</a> <a href="/admin">{{t "nav.admin"}}</a>{{end}}
                <a href="/api-docs">{{t "nav.api"}}</a>
                <span class="nav-user">
                    {{if .User}}
                    <a href="/user" title="{{.User.Name}} Â· {{t "nav.edit_profile_title"}}" class="nav-user-tag"{{if .User.Colour}} style="background:{{.User.Colour}};color:{{.User.TextColour}}"{{end}}>
                        {{if .User.DisplayTag}}{{.User.DisplayTag}}{{else}}?{{end}}
                    </a>
                    {{else}}
                    <a href="/auth/login" title="{{t "nav.login"}}">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998-0.059A7.5 7.5 0 0 1 8.25 21.75H4.5a.75.75 0 0 1-.75-.75v-.75Z" />
                        </svg>
                    </a>
                    {{end}}
                </span>
            </nav>
        </header>
        {{if .PageTitle}}
        <div class="page-title-row">
            <h2>{{t .PageTitle}}</h2>
            {{if .TitleExtra}}<div class="title-extra">{{.TitleExtra}}</div>{{end}}
        </div>
        {{end}}
        {{.Content}}
    </div>
    {{end}}
    <div id="file-comment-tooltip" class="file-comment-tooltip" role="tooltip" aria-hidden="true"></div>
    <script>
    (function commentTooltip() {
        var tooltip = document.getElementById('file-comment-tooltip');
        if (!tooltip) return;
        var hoverTimer = null, hideTimer = null, pinned = false;
        function show(el) {
            var comment = el.dataset.comment;
            if (!comment) return;
            clearTimeout(hideTimer);
            tooltip.textContent = comment;
            tooltip.classList.add('is-visible');
            tooltip.setAttribute('aria-hidden', 'false');
            function position() {
                var rect = el.getBoundingClientRect();
                var ttRect = tooltip.getBoundingClientRect();
                var left = rect.left, top = rect.bottom + 6;
                if (left + ttRect.width > globalThis.innerWidth) left = globalThis.innerWidth - ttRect.width - 8;
                if (left < 8) left = 8;
                if (top + ttRect.height > globalThis.innerHeight - 8) top = rect.top - ttRect.height - 6;
                if (top < 8) top = 8;
                tooltip.style.left = left + 'px';
                tooltip.style.top = top + 'px';
            }
            position();
            requestAnimationFrame(position);
        }
        function hide() {
            if (pinned) return;
            tooltip.classList.remove('is-visible');
            tooltip.setAttribute('aria-hidden', 'true');
        }
        function scheduleHide() {
            clearTimeout(hideTimer);
            hideTimer = setTimeout(hide, 150);
        }
        document.addEventListener('mouseenter', function(e) {
            var icon = e.target.closest && e.target.closest('.file-comment-icon');
            if (!icon) return;
            clearTimeout(hideTimer);
            hoverTimer = setTimeout(function() { show(icon); }, 200);
        }, true);
        document.addEventListener('mouseleave', function(e) {
            var icon = e.target.closest && e.target.closest('.file-comment-icon');
            if (!icon) return;
            clearTimeout(hoverTimer);
            scheduleHide();
        }, true);
        document.addEventListener('click', function(e) {
            var icon = e.target.closest && e.target.closest('.file-comment-icon');
            if (icon) {
                e.preventDefault();
                clearTimeout(hoverTimer);
                clearTimeout(hideTimer);
                if (pinned && tooltip.classList.contains('is-visible')) { pinned = false; hide(); }
                else { pinned = true; show(icon); }
                return;
            }
            if (pinned) { pinned = false; hide(); }
        });
        document.addEventListener('keydown', function(e) {
            var icon = e.target.closest && e.target.closest('.file-comment-icon');
            if (icon && (e.key === 'Enter' || e.key === ' ')) {
                e.preventDefault();
                icon.click();
                return;
            }
            if (e.key === 'Escape' && pinned) { pinned = false; hide(); }
        });
    })();
    globalThis.addEventListener('load', function() {
        var hash = globalThis.location.hash;
        if (hash && hash.indexOf('file-') === 1) {
            var el = document.getElementById(hash.slice(1));
            if (el) el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    });
    document.body.addEventListener('htmx:afterSettle', function() {
        var hash = globalThis.location.hash;
        if (hash && hash.indexOf('file-') === 1) {
            var el = document.getElementById(hash.slice(1));
            if (el) el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    });
    document.addEventListener('click', function(e) {
        var btn = e.target.closest && e.target.closest('.file-copy-link');
        if (!btn) return;
        var viewUrl = btn.dataset.viewUrl;
        var downloadUrl = btn.dataset.downloadUrl;
        var path = (viewUrl && viewUrl.trim() !== '') ? viewUrl : downloadUrl;
        if (!path) return;
        var url = globalThis.location.origin + path;
        var copied = document.body.dataset.copied || 'Copied!';
        var copyLink = btn.getAttribute('title');
        navigator.clipboard.writeText(url).then(function() {
            btn.classList.add('copied');
            btn.setAttribute('title', copied);
            setTimeout(function() { btn.classList.remove('copied'); btn.setAttribute('title', copyLink); }, 1500);
        });
    });
    </script>
</body>
</html>
